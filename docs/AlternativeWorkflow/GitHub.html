<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenCPN Developer Manual</title>
    <link rel="canonical" href="https://leamas.github.io/ocpn-manuals/AlternativeWorkflow/GitHub.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://leamas.github.io/ocpn-manuals">OpenCPN Developer Manual</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="AlternativeWorkflow" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Alternative Managed Workflow for OpenCPN plugins</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Using the Alternative Managed Workflow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Alternative-Workflow.html">The Alternative Workflow</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Metadata-Flow.html">Metadata Files</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Appveyor.html">Appveyor</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CircleCI.html">CircleCI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cloud-Service-Changes.html">Cloud service changes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cloudsmith.html">Cloudsmith</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Travis.html">Travis</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="GitHub.html">GitHub</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Plugin-Adaptation.html">Adapting the plugin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CodeChange.html">Code Changes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Local-Build.html">Building locally</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Useful-Stuff.html">Useful information</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Plugin-Dependencies.html">Plugin Dependencies</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Alternative Managed Workflow for OpenCPN plugins</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Alternative Managed Workflow for OpenCPN plugins</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../ocpn-dev-manual/5.3.1/index.html">OpenCPN Developer Manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../ocpn-dev-manual/5.3.1/index.html">5.3.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../plugin-installer/0.0.1/Home.html">Plugin Installer Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../plugin-installer/0.0.1/Home.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../shipdriver/0.0.1/shipdriver.html">ShipDriver OpenCPN plugin docs.</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../shipdriver/0.0.1/shipdriver.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../ocpn-dev-manual/5.3.1/developer_guide.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Alternative Managed Workflow for OpenCPN plugins</a></li>
    <li><a href="GitHub.html">GitHub</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/Rasbats/managed_plugins/edit/asciidoc/docs/modules/ROOT/pages/GitHub.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_backup"><a class="anchor" href="#_backup"></a>Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before making any changes to the master branch of your plugin make
another branch. This will act as a backup of the state of your plugin
before moving to the managed workflow.</p>
</div>
<div class="paragraph">
<p>Two Rasbats GitHub repos are involved in the managed build. *
TideFinder_pi * plugins</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tidefinder_pi"><a class="anchor" href="#_tidefinder_pi"></a>TideFinder_pi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The changes to the plugin files have been
<a href="CodeChange.html" class="page">shown here.</a>
They are pushed to the Rasbats GitHub repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_plugins_fork_repository"><a class="anchor" href="#_the_plugins_fork_repository"></a>The plugins fork repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Rasbats GitHub repo is a fork of opencpn/plugins:
<a href="https://github.com/opencpn/plugins" class="bare">https://github.com/opencpn/plugins</a>.</p>
</div>
<div class="sect2">
<h3 id="_master_catalog_builds"><a class="anchor" href="#_master_catalog_builds"></a>Master catalog builds</h3>
<div class="paragraph">
<p>Create an `auto' branch. By default this is a clone of the master
branch. The auto branch of plugins will receive the plugin metadata
files made by the builders. After the builds the auto branch is merged
with the master to allow a pull request to OpenCPN/plugins. The metadata
files for TideFinder are added to the Master catalog.</p>
</div>
</div>
<div class="sect2">
<h3 id="_beta_catalog_builds"><a class="anchor" href="#_beta_catalog_builds"></a>Beta catalog builds</h3>
<div class="paragraph">
<p>Delete the auto branch if it exists. Create a new auto branch based on
plugins/Beta.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>$ git branch -D auto (drop the auto branch completely)</p>
</li>
<li>
<p>$ git remote update upstream (Better safe than sorry)</p>
</li>
<li>
<p>$ git checkout -b auto upstream/Beta (Create a new auto branch based
on Beta)</p>
</li>
<li>
<p>$ git push -f origin auto:auto (unconditionally overwrite the github
branch)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the builds the auto branch is merged with the Beta to allow a pull
request from this branch to OpenCPN/plugins/Beta. The metadata files for
TideFinder are added to the Beta catalog.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_providing_the_link_to_your_opencpnplugins_fork"><a class="anchor" href="#_providing_the_link_to_your_opencpnplugins_fork"></a>Providing the link to your opencpn/plugins fork</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the script <em>ci/new-credentials</em> in the TideFinder repo. The script
will ask for the ssh url to your plugins fork repo and a secret
password.
<span class="image"><img src="_images/github/1.plugins.jpg" alt="1.plugins.jpg"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dont forget the password…</p>
</li>
<li>
<p>The script will create an encrypted private + a public key in the <em>ci</em>
directory. Commit and push these to Github TideFinder.</p>
</li>
<li>
<p>Register the new public key (displayed by new-credentials) as a
deployment key with write permissions (Allow write access) on your
github OpenCPN plugins fork repo (in Settings | Deploy keys)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/github/10.deploy.key.jpg" alt="10.deploy.key.jpg"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/github/9.deploy.key.jpg" alt="9.deploy.key.jpg"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_plugin"><a class="anchor" href="#_building_the_plugin"></a>Building the plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Checks</strong> * Have the environment variables been entered for CircleCI,
Travis and Appveyor?</p>
</div>
<div class="paragraph">
<p><a href="CircleCI.html" class="page">CircleCI</a></p>
</div>
<div class="paragraph">
<p><a href="Travis.html" class="page">Travis</a></p>
</div>
<div class="paragraph">
<p><a href="Appveyor.html" class="page">Appveyor</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Has a deploy key (with write permissions) been added to your
OpenCPN/plugins fork repo?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#">Github</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are the Cloudsmith repos ready to receive your builds?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="Cloudsmith.html" class="page">Cloudsmith</a></p>
</div>
<div class="paragraph">
<p><strong>Building</strong></p>
</div>
<div class="paragraph">
<p>When the changes have been made to the plugin it is a good idea to make
an untagged build. The builds will arrive in the Cloudsmith
opencpn/tidefinder-alpha repository. The plugin can be tested for
functionality by using the <strong>Import plugin…</strong> button in OpenCPN.</p>
</div>
<div class="paragraph">
<p>The untagged build metadata files are not pushed to the auto branch of
your GitHub OpenCPN/plugins fork repo.</p>
</div>
<div class="paragraph">
<p>Now a tagged beta build can be made. The tag name needs to include the
word `beta'. For example `v1.2.5-beta' This build pushes the plugin
tarballs and metadata xml files to Cloudsmith opencpn/tidefinder-beta.
At the same time the metadata files are pushed to the auto branch of
your GitHub OpenCPN/plugins fork repo.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/cloudsmith/1.tidefinder.beta.repo.jpg" alt="1.tidefinder.beta.repo.jpg"></span></p>
</div>
<div class="paragraph">
<p>The beta build can be tested in the same way as the experimental
untagged version. Use the <strong>Import plugin…</strong> button in OpenCPN.</p>
</div>
<div class="paragraph">
<p>When you want the plugin to be added to the master catalog another
tagged build is made. The tag name must not contain `beta'. For example
`v1.2.5'. The source code for tagged builds, either beta or production
ends up in GitHub TideFinder repo tag pages. The reason for using
untagged builds initially is to avoid cluttering up this part of your
GitHub repo. Unwanted tags can be removed
<a href="Useful-Stuff.html" class="page">using this technique</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pull_request_from_plugins"><a class="anchor" href="#_pull_request_from_plugins"></a>pull request from plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before making the pull request to OpenCPN/plugins make sure your fork of
this is up to date.
<a href="https://rick.cogley.info/post/update-your-forked-repository-directly-on-github/">This
guide</a> has been found useful.</p>
</div>
<div class="paragraph">
<p>The builders will make commits in your plugins fork auto branch, one for
each build. These commits are the metadata files which work with the
plugin installer of the main OpenCPN program. In beta and production
mode they become part of the beta and master catalogs of plugins in
OpenCPN.</p>
</div>
<div class="paragraph">
<p><strong>Master catalog</strong></p>
</div>
<div class="paragraph">
<p>If you are adding the metadata files from your plugins auto branch to
your OpenCPN/plugins fork master branch it goes like this:</p>
</div>
<div class="paragraph">
<p>This may be needed to sync the master branch:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>* $ git checkout master
* $ git rebase upstream/master</pre>
</div>
</div>
<div class="paragraph">
<p>Then:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>* $ git checkout auto
* $ git rebase master
* $ git checkout master
* $ git merge --squash auto
* $ git commit
* $ git push</pre>
</div>
</div>
<div class="paragraph">
<p>A PR (pull request) can then be made from your plugins master branch for
updating the master catalog of OpenCPN/plugins.</p>
</div>
<div class="paragraph">
<p><strong>Beta catalog</strong></p>
</div>
<div class="paragraph">
<p>If you configured for Beta metadata files you need:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>* $ git checkout auto
* $ git rebase Beta
* $ git checkout Beta
* $ git merge --squash auto
* $ git commit
* $ git push</pre>
</div>
</div>
<div class="paragraph">
<p>The new TideFinder metadata files have been added to your
OpenCPN/plugins fork Beta branch. A PR results in updating the Beta
catalog of OpenCPN/plugins, if it is accepted.</p>
</div>
<div class="paragraph">
<p><a href="Alternative-Workflow.html" class="page">The Alternative Workflow</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CI: Push build to Git Release :: OpenCPN Developer Manual</title>
    <link rel="canonical" href="https://leamas.github.io/ocpn-manuals/ocpn-dev-manual/5.3.1/ci-push-build-to-git.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://leamas.github.io/ocpn-manuals">OpenCPN Developer Manual</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocpn-dev-manual" data-version="5.3.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">OpenCPN Developer Manual</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer Manual</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="community.html">Community</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="compiling_linux.html">Compiling on Linux</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="building-on-armhf-linux-armbian-orange-pi.html">Building on armhf linux - Armbian - Orange Pi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="building_on_motorola_xoom.html">Building on Motorola Xoom</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="compiling_on_slackware.html">Compile on Slackware</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rpi2.html">Compile on Raspberry PI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="compiling_windows.html">Compiling on Windows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="compiling_mac_osx.html">Compiling on macOS</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="modularized_packaging.html">Modularized Packaging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="code_formatting.html">Code Formatting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="messaging.html">Messaging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Plugin API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugin_api_versions.html">Plugin API Versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ocpn_draw_odapi.html">OCPN Draw ODAPI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="standalone_plugin_compilation.html">Plugin Compilation Win</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting_plugins.html">Troubleshooting Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="plugin_guidelines.html">Plugin Guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="plugin_documentation.html">Plugin Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="plugin_submissions.html">Plugin Submissions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Learning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="testplugin.html">Testplugin and Frontend2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="demo_plugin.html">Demonstration Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="coding_solutions.html">Coding Solutions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fork_build_windows.html">Fork and Build (Windows)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oplaydo1.html">oplaydo1 (Windows)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fork_and_build_linux.html">Fork and Build (Linux)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oplaydo1_linux.html">oplaydo1 (Linux)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bug_and_feature_tracking.html">Bugs and feature tracking</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pi_dependencies.html">PI Dependencies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pi_installer_summary.html">PI Manager Summary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pi_installler_dev_setup.html">PI Manager Dev Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pi_installer_catalog_meta.html">PI Manager Catalog &amp; Meta-Url</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pi_installer_summary.html">PI Manager Dev Procedure</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="ci-push-build-to-git.html">CI: Push build to Git Release</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ci-push-linux-build-to-launchpad.html">CI: Push Linux Build to Launchpad</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ci_travis_encryption_windows.html">CI: Travis Encryption for Windows Dev</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanceddebugtips.html">CI Advanced Debug Tips</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="codacy.html">Codacy:Automate code quality</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="testquality.html">TestQuality -Test Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="online_tools.html">Online Nmea Tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="user_interface_styling.html">User Interface Styling</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="updating_the_user_manual.html">Updating the User Manual</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../shipdriver/0.0.1/shipdriver.html">Shipdriver manual DEMO</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenCPN Developer Manual</span>
    <span class="version">5.3.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../AlternativeWorkflow/index.html">Alternative Managed Workflow for OpenCPN plugins</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../AlternativeWorkflow/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">OpenCPN Developer Manual</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">5.3.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../plugin-installer/0.0.1/Home.html">Plugin Installer Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../plugin-installer/0.0.1/Home.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../shipdriver/0.0.1/shipdriver.html">ShipDriver OpenCPN plugin docs.</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../shipdriver/0.0.1/shipdriver.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="developer_guide.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenCPN Developer Manual</a></li>
    <li>Developer Manual</li>
    <li><a href="ci-push-build-to-git.html">CI: Push build to Git Release</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CI: Push build to Git Release</h1>
<div class="sect1">
<h2 id="_initiate_the_push_with_git_push_origin_tag"><a class="anchor" href="#_initiate_the_push_with_git_push_origin_tag"></a>Initiate the push with 'git push origin [tag]'</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In both .travis and appveyor it is possible to initiate the push of a
build to your Git repository. These instructions assume that you
appveyor and travis accounts and know your way around their services and
basic process. Your travis account is used to confirm 'successful'
builds of linux and osx, and to create those packages and releases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_push_a_travis_built_file_to_a_new_github_release"><a class="anchor" href="#_how_to_push_a_travis_built_file_to_a_new_github_release"></a>How to push a .Travis 'built' file to a new Github 'Release'</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For travis refer to
<a href="http://www.cruisersforum.com/forums/f134/tactics-plugin-166909-2.html#post2913910">Petri&#8217;s
post #637</a></p>
</div>
<div class="sect2">
<h3 id="_a_configure_cmake_and_the_travis_file_for_security_and_permissions"><a class="anchor" href="#_a_configure_cmake_and_the_travis_file_for_security_and_permissions"></a>A. Configure CMake and the Travis file for security and permissions</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You can use this Dashboard-Tactics_pi
<a href="https://github.com/canne/dashboard_tactics_pi/blob/master/.travis.yml">.travis</a>
file as it is. The MacOSX section packages a fully automated
installation (FAI). The two build target conditional variables are
courtesy from Sean d&#8217;Epagnier&#8217;s repositories.</p>
</li>
<li>
<p>Also changes in Cmake include files are needed for Mac Packaging, in
particular
<a href="https://github.com/canne/dashboard_tactics_pi/blob/master/cmake/PluginPackage.cmake">PluginPackage.cmake</a>
note the MacOSX entries. Also see
<a href="http://www.cruisersforum.com/forums/f134/tactics-plugin-166909-12.html#post2904905">this
post and necessary changes by Nereus32</a> (There may be some other changes
to cmake needed..Petri?)`+'- SET(TACTICS_INSTRUMENTS ON)'
IF (TACTICS_INSTRUMENTS)
PROJECT(dashboard_tactics_pi)
SET(PACKAGE_NAME dashboard_tactics_pi)
SET(VERBOSE_NAME DashboardTactics)
SET(TITLE_NAME DashboardTactics)
ELSE (TACTICS_INSTRUMENTS)
PROJECT(dashboard_pi)
SET(PACKAGE_NAME dashboard_pi)
SET(VERBOSE_NAME Dashboard)
SET(TITLE_NAME Dashboard)
ENDIF (TACTICS_INSTRUMENTS)
`</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Plus, take the dashboard_tactics_pi.pkgproj.in where I modified the key NAME as instructed.
Repeat the build process from zero on an empty build directory and let me know.</p>
</div>
</div>
<div class="sect2">
<h3 id="_b_bottom_of_travis_yml_file"><a class="anchor" href="#_b_bottom_of_travis_yml_file"></a>B. Bottom of travis.yml file</h3>
<div class="paragraph">
<p>Example Bottom section of the travis.yml file. Note: indentation is
important in yml files, child parts MUST be indeted below the owner.
This is shown below by "api_key:" being the owner and "secure:" being
the child, noticd that "secure:" is indented.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>deploy:
- provider: releases
  api_key:
    secure: "Your encrypted github token here"
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,txz,pkg,pkg.tar.xz}"
  skip_cleanup: true
  on:
    repo: canne/dashboard_tactics_pi
    tags: true
    all_branches: true</pre>
</div>
</div>
<div class="paragraph">
<p>If you want another deploy section, like launchpad, you will need to
create a new "- provider:" with the text "launchpad" following it. Both
"- provider:" labels need to have the same indentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_c_install_travis_cli_to_encrypt_a_github_secure_public_key"><a class="anchor" href="#_c_install_travis_cli_to_encrypt_a_github_secure_public_key"></a>C. Install Travis CLI to encrypt a Github secure public key</h3>
<div class="ulist">
<ul>
<li>
<p>You need a travis CLI (command line interface) to be able to encrypt
the GitHub token. The encrypted string is put in your personal
*travis.yml file. Unlike AppVeyor services, there is no on-line
encryption service, that&#8217;s why you need to start with a travis CLI
installation</p>
</li>
<li>
<p>[[<a href="https://github.com/travis-ci/travis.rb|Travis" class="bare">https://github.com/travis-ci/travis.rb|Travis</a> CLI Tool]] for Windows Developers use [[opencpn:developer_manual:ci_travis_encryption_windows|Rubyinstaller/Gem/Travis]] which still uses 1Gb of disk space but is the easiest alternative.</p>
</li>
<li>
<p>Travis CLI installation instructions for Windows (Suggest use of "Travis CLI Tool" above). When you are sure that you have travis CLI up and working, you can start to create the encrypted key. Without it, deployment to GitHub does not work.</p>
</li>
<li>
<p>Travis CLI installation instructions for Linux are just below. Note that Windows10 users can:</p>
<div class="ulist">
<ul>
<li>
<p>Install a Travis CLI Tool as listed above (easiest).</p>
</li>
<li>
<p>Create a [[<a href="https://opencpn.org/wiki/dokuwiki/doku.php?id=opencpn:supplementary_software:run-ubuntu-in-win10|WSL-Windows" class="bare">https://opencpn.org/wiki/dokuwiki/doku.php?id=opencpn:supplementary_software:run-ubuntu-in-win10|WSL-Windows</a> Subsystem for Linux (Ubuntu 18.04LTS) on Win10 Installation]].</p>
</li>
<li>
<p>or create a Virtual Box and install Ubuntu Linux.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>and then from the linux command prompt execute:`
  sudo apt-get update --fix-missing
  sudo apt-get install ruby
  sudo apt-get install gem
  ruby -v
  gem install travis -v 1.8.10 --no-rdoc --no-ri
  travis version
  response: 1.8.10.</p>
</div>
<div class="paragraph">
<p>225mb disk space used.
`</p>
</div>
</div>
<div class="sect2">
<h3 id="_d_encrypt_a_github_api_token_with_travis_encrytion"><a class="anchor" href="#_d_encrypt_a_github_api_token_with_travis_encrytion"></a>D. Encrypt a Github API Token with Travis encrytion</h3>
<div class="ulist">
<ul>
<li>
<p>Create a Github API token for travis in GitHub here
<a href="https://github.com/settings/tokens">Developer tools</a>. Select all rights
to repository "repo" and repository only (that&#8217;s enough - if it does not
work, it is something else). Don&#8217;t close the window until you have made
a copy of your key.</p>
</li>
<li>
<p>Open command window and give following command (in Linux) with travis
CLI:`+  echo [Paste GitHub Token Here] | travis encrypt -r [username]/[repository_name] --org
+`</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_e_copy_and_paste_the_encrypted_key_into_the_travis_secure_field"><a class="anchor" href="#_e_copy_and_paste_the_encrypted_key_into_the_travis_secure_field"></a>E. Copy and Paste the encrypted key into the Travis secure field</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The command above produces a very long arbitrary string in format
"1234abcde….f".</p>
</li>
<li>
<p>Copy and paste that into .travis.yml in secure field as one single
line. Don&#8217;t let your editor to break it on different lines.</p>
</li>
<li>
<p>Warning: Beware the interweb instructions, which are supposed to
modify the .travis.yml on the fly…they mes up the file completely the
file. So stick to copy-paste.</p>
</li>
<li>
<p>Save the Travis file.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_f_start_building_the_travis_project"><a class="anchor" href="#_f_start_building_the_travis_project"></a>F. Start building the .travis project</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You will need to turn the project "on" after signing into your travis
account. Click on the icon in the top right with the down chevron and
select 'Settings', the page will display your respitories under the
'Repositories' tab. Make sure the ones you want to use have the slider
button to the right with a tick in the button. If it is to the left and
shows a cross it is not active.</p>
</li>
<li>
<p>Remember to change VERSION.cmake patch number and date, an commit and
push that too! This is important if you are going to create a release as
this will help identify the build objects belonging to the release.</p>
</li>
<li>
<p>Then when you commit and push the .travis.yml file, the travis build
will start. It is good to check that both of its build processes do pass
faultlessly before the next step.</p>
</li>
<li>
<p>It takes awhile for each commit (Linux and Mac) to build correctly, be
patient when it is running.</p>
</li>
<li>
<p>Make sure it built successfully. The project will not be saved because
travis does not provide that type of storage space.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_g_deploy_build_to_github"><a class="anchor" href="#_g_deploy_build_to_github"></a>G. Deploy 'build' to Github</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Now the project is ready to create a Release in Github. There are two
ways to do this.</p>
</li>
<li>
<p>Option 1: Create the new 'Tag' from within Github Release Tab.</p>
<div class="ulist">
<ul>
<li>
<p>In GitHub create a repository, like v1.2.3 as 'tag', description can be anything, but it best to include the version. This is where Travis and AppVeyor both deploy the built contents.</p>
</li>
<li>
<p>When you hit the create button, Travis and AppVeyor will create the 'build' and deploy (the condition flags in the configuration file are define this action) to the Github 'Release' Tag.</p>
</li>
<li>
<p>That&#8217;s why it&#8217;s important to check before you create the 'Tag' that all builds do pass faultlessly. (Repositories cannot be deleted since they are, in fact defined by tags.)</p>
</li>
<li>
<p>If you observe 401 error at the deployment phase in travis logs search in google.com with the following phrase for possible causes "travis github [[<a href="https://api.github.com/user|https://api.github.com/user" class="bare">https://api.github.com/user|https://api.github.com/user</a>]]: 401 - bad credentials"</p>
</li>
<li>
<p>Option 2: Command Line - Make a 'Tag' locally and push it to your remote.</p>
<div class="ulist">
<ul>
<li>
<p>From your command line create a new tag locally, and then push that tag to your remote repository.</p>
</li>
<li>
<p>All the same cautions apply, make sure it builds properly first.&lt;code&gt;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>OPTION 2: TAG COMMANDS Make tag locally and push to remote git tag
v1.13.1 &#8592;-Create the tag on your local repository git push origin
v1.13.1 &#8592;-Push the tag to your remote repository, travis creates build
and pushes. git push –delete origin v1.13.1 &#8592;-You&#8217;ve made a mistake, it
fails to build, remove remote tag. git tag –delete v1.13.1 &#8592;-You&#8217;ve
made a mistake, it fails to build, remove local tag. Fix the problem and
start over. &lt;/code&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_h_troubleshooting"><a class="anchor" href="#_h_troubleshooting"></a>H. Troubleshooting</h3>
<div class="paragraph">
<p>When the Travis build does not work the error messages can be obscure
and not really help too much. A typical message may be:</p>
</div>
<div class="paragraph">
<p>Skipping a deployment with the provider because this branch is not
permitted:</p>
</div>
<div class="paragraph">
<p>This is not very helpful as it just says something went wrong not what.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check your whole .travis.yml file. Look at it carefully and compare it
to the example given.</p>
</li>
<li>
<p>Make sure you have the security token enclosed in double quotes, i.e.
"security/token"</p>
</li>
<li>
<p>Make sure the build process has actually worked for the file types you
are trying to transfer to github</p>
</li>
<li>
<p>If you have extra values in your yml file make sure you really know
what they do. If you have issues, take all the extranous values out and
see if it works then.</p>
</li>
<li>
<p>If necessary find a very small project and play with that as it will
compile much quicker.</p>
</li>
<li>
<p>Make all changes in a branch of the main repository as you will have
to do multiple commits to get it working. Once it is working you can
make the changes to your main branch(es) and clean up the 'test' branch</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_push_an_appveyor_built_file_to_a_new_github_release"><a class="anchor" href="#_how_to_push_an_appveyor_built_file_to_a_new_github_release"></a>How to push an Appveyor 'built' file to a new Github 'Release'</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The use and configuration of Appveyor is similar to Travis in many
respects. We use Appveyor to create Windows packages.</p>
</div>
<div class="sect2">
<h3 id="_a_configure_appveyor_yml_file_for_security_and_permissions"><a class="anchor" href="#_a_configure_appveyor_yml_file_for_security_and_permissions"></a>A. Configure Appveyor.yml file for security and permissions</h3>
<div class="listingblock">
<div class="content">
<pre># Artifacts Configuration
artifacts: # push all files in directory
  path: build\*.exe
  name: installer

# Deploy to GitHub Releases
deploy:
# description: 'release created by AppVeyor CI'
  provider: GitHub
  auth_token: # '%GitHub_auth_token%'
    secure: VVAVg9a...[put the appveyor encryption of your github public token here ]...f1OSYg0tS
  artifact: installer
  draft: true
  prerelease: true
  tag: $(APPVEYOR_REPO_TAG_NAME) # use pushed Tag or insert version name
  on:
    configuration: Release  # Debug contains non-redist MS DLLs
    APPVEYOR_REPO_TAG: true   # deploy on tag push only
#   branch: master   # release from master branch only</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use this Weatherfax_pi
<a href="https://github.com/seandepagnier/weatherfax_pi/files/3112304/appveyor.yml.txt">appveyor.yml</a>
file for reference and there are some
<a href="https://github.com/seandepagnier/weatherfax_pi/issues/134">in process
notes</a> available.</p>
</div>
<div class="paragraph">
<p>Login to your Appveyor Account and Create a
<em><a href="https://github.com/settings/tokens">Github API Public Security Token</a></em>
under <em>New Personal Token</em>, entering a "Note" similar to
<em>Appveyor_auth_token</em>[plugin_name]_ and then select a Permissions
"Scope" for "REPO" by checking "Repo".
. Copy the resulting code to your clipboard and somewhere else, as this
is the last time you will have access to the public key.</p>
</div>
</div>
<div class="sect2">
<h3 id="_b_encrypt_a_github_secure_public_key_using_appveyor_encrypt_service"><a class="anchor" href="#_b_encrypt_a_github_secure_public_key_using_appveyor_encrypt_service"></a>B. Encrypt a Github secure public key using Appveyor Encrypt Service</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sign into the <a href="https://ci.appveyor.com/tools/encrypt">Appveyor
Encryption Service</a> and paste the public key into the field.</p>
</li>
<li>
<p>Push "Encrypt". Copy the result to clipboard.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_c_copy_and_paste_the_encrypted_key_into_the_appveyor_secure_field"><a class="anchor" href="#_c_copy_and_paste_the_encrypted_key_into_the_appveyor_secure_field"></a>C. Copy and Paste the encrypted key into the Appveyor secure field</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Then paste that into the appveyor.yml file after auth_token: and
secure:, where the words <em>&lt;encrypted GitHub API token here&gt;</em> occur. The
encrypted public token can be enclosed by quotes.</p>
</li>
<li>
<p>Save the appveyor.yml file,</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_d_start_building_the_appveyor_project"><a class="anchor" href="#_d_start_building_the_appveyor_project"></a>D. Start building the Appveyor project</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You will need to select or turn the project "on" after signing into
your appveyor account.</p>
</li>
<li>
<p>Then when you commit appveyor.yml file, the appveyor 'build' will
start. It is good to check that its build processes do pass faultlessly
before the next step. Commit and push to the remote repository.</p>
</li>
<li>
<p>Additionally you must remember to change VERSION.cmake patch number
and date, an commit and push that!`+git add appveyor.yml
git commit -a -m "update appveyor.yml"
git push origin master</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_e_deploy_build_to_github"><a class="anchor" href="#_e_deploy_build_to_github"></a>E. Deploy 'build' to Github</h3>
<div class="ulist">
<ul>
<li>
<p>It takes awhile for the commit (Windows) to build correctly, be
patient when it is running.</p>
</li>
<li>
<p>Make sure it built successfully by checking that the Artifact Tab for
the install package file.</p>
</li>
<li>
<p>Now the project is ready to create a Release in Github. There are two
ways to do this.</p>
</li>
<li>
<p>Option 1: Create the new 'Tag' from within Github Release Tab.</p>
</li>
<li>
<p>In GitHub create a repository, like v1.2.3 as 'tag', description can be anything, but it best to include the version. This is where Travis and AppVeyor both deploy the built contents.</p>
</li>
<li>
<p>When you hit the create button, Travis and AppVeyor will create the 'build' and deploy (the condition flags in the configuration file are define this action) to the Github 'Release' Tag.</p>
</li>
<li>
<p>That&#8217;s why it&#8217;s important to check before you create the 'Tag' that all builds do pass faultlessly. (Repositories cannot be deleted since they are, in fact defined by tags.)</p>
</li>
<li>
<p>If you observe 401 error at the deployment phase in travis logs search in google.com with the following phrase for possible causes "travis github [[<a href="https://api.github.com/user|https://api.github.com/user" class="bare">https://api.github.com/user|https://api.github.com/user</a>]]: 401 - bad credentials"</p>
</li>
<li>
<p>Option 2: Command Line - Make a 'Tag' locally and push it to your remote.</p>
<div class="ulist">
<ul>
<li>
<p>From your command line create a new tag locally, and then push that tag to your remote repository.</p>
</li>
<li>
<p>All the same cautions apply, make sure it builds properly first.&lt;code&gt;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>OPTION 2: TAG COMMANDS Make tag locally and then push to remote &lt;/code&gt;</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git tag v1.9.1-ov42    &lt;--Create the tag on your local repository
git push origin v1.9.1-ov42  &lt;--Push the tag to your remote repository, travis creates build and pushes.
git push –delete origin v1.9.1-ov42  &lt;--You've made a mistake, it fails to build, remove remote tag.
git tag –delete v1.9.1-ov42  &lt;--You've made a mistake, it fails to build, remove local tag.
Fix the problem and start over.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_f_what_happens_upon_deployment"><a class="anchor" href="#_f_what_happens_upon_deployment"></a>F. What happens upon Deployment</h3>
<div class="ulist">
<ul>
<li>
<p>The git push origin v1.9.1-ov42 Tag command is executed.</p>
</li>
<li>
<p>Upon which a new Release &amp; Tag "v1.9.3-ov42-test" gets created in
GitHub "Releases", which now contains the results of the - - Appveyor
build under the "Assets" label. You should find a file similar to
"weatherfax_pi-1.9.3-ov42-win32.exe".</p>
</li>
<li>
<p>See
<a href="https://github.com/rgleason/weatherfax_pi/releases/tag/v1.9.3-ov42-test">https:__github.com/rgleason/weatherfax_pi/releases/tag/v1.9.3-ov42-test</a>]</p>
</li>
<li>
<p>The Appveyor 'Console Tab' shows:
[[https:<em>ci.appveyor.com/project/rgleason/weatherfax-pi|https:</em>ci.appveyor.com/project/rgleason/weatherfax-pi]]</p>
</li>
<li>
<p>The Appveyor "Artifacts Tab" shows the file pushed to Github</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>'Release':
https:__ci.appveyor.com/project/rgleason/weatherfax-pi/build/artifacts|https://ci.appveyor.com/project/rgleason/weatherfax-pi/build/artifacts`+  Collecting artifacts...
  Found artifact 'build\weatherfax_pi-1.9.3-ov42-win32.exe' matching 'build\*.exe' path
  Uploading artifacts...
  [1/1] build\weatherfax_pi-1.9.3-ov42-win32.exe (721,873 bytes)...100%
  Deploying using GitHub provider
  Creating "v1.9.3-ov42-test" release for repository "rgleason/weatherfax_pi" tag "v1.9.3-ov42-test" commit "05b6418e674b7d722424146c8efe2745a88b635b"...OK
  Uploading "weatherfax_pi-1.9.3-ov42-win32.exe" to release assets...OK
  Build success</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_g_how_to_get_to_these_appveyor_locations_the_simplest_way_to_access"><a class="anchor" href="#_g_how_to_get_to_these_appveyor_locations_the_simplest_way_to_access"></a>G. How to get to these Appveyor Locations? The simplest way to access</h3>
<div class="paragraph">
<p>Appveyor is through Github commits
eg:https://github.com/rgleason/weatherfax_pi/commits/master</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If appveyor succeeds in creation of an Artifact - green check.</p>
</li>
<li>
<p>If appveyor succeeds in creation of an Artifact and a Release (if a
new Tag is pushed to remote.) - green check.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that VERSION.cmake entries/changes and TAG must be manually
coordinated!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_notes"><a class="anchor" href="#_additional_notes"></a>Additional Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about setting the auth_token security please read
notes in Appveyor Forum discussions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://help.appveyor.com/discussions/problems/23134-push-built-file-to-opensource-public-github-release#comment_47202099">Push
built Artifact .exe to Github "Release" (opensource, public repos, dev
account) Post 13 by fcgleason on Apr 23, 2019 @ 09:31 PM</a></p>
</li>
<li>
<p>See
<a href="https://help.appveyor.com/discussions/questions/36997-git-branch-delete-and-git-squash-effect-on-appveyor">Git
branch --delete and Git Squash -Effect on Appveyor</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It just updates the patch number and updates the Appveyor file so that
we can push a new tag to the remote repository and then appveyor will
push the windows artifact into the Release (new tag). (This just
requires the setup of a personnal auth_token and copying the Yaml
encrypted version of that into the appveyor file.)</p>
</div>
<div class="paragraph">
<p>It&#8217;s a nice efficient way to make a release with an identical tag. This
is what I&#8217;ve done on my repository:</p>
</div>
<div class="sect2">
<h3 id="_more_information_for_appveyor"><a class="anchor" href="#_more_information_for_appveyor"></a>More information for Appveyor</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.cruisersforum.com/forums/f134/beta-test-technical-30929-7.html#post2876644">Post
#2396</a></p>
</li>
<li>
<p><a href="http://www.cruisersforum.com/forums/f134/beta-test-technical-30929-6.html#post2887625">Post
#2047</a></p>
</li>
<li>
<p><a href="http://www.cruisersforum.com/forums/f134/beta-test-technical-30929-4.html#post2894107">Post
#2425</a></p>
</li>
<li>
<p><a href="https://github.com/seandepagnier/weatherfax_pi/issues/134">Use of
appveyor 'auth_token' to push a new github release #134</a></p>
</li>
<li>
<p><a href="http://www.cruisersforum.com/forums/f134/beta-test-technical-30929-7.html#post2873659">Getting
auth token</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
